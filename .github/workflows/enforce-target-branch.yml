name: Enforce Target Branch

# Automatically close pull requests that target the master branch.
# All contributions should target the develop branch instead.

on:
  pull_request_target:
    types: [opened]
    branches:
      - master

jobs:
  close-pr:
    name: Close PR targeting master
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    steps:
      - name: Comment and close
        uses: actions/github-script@v7
        with:
          script: |
            const head = context.payload.pull_request.head.ref;
            // Allow PRs from develop to master (release merges)
            if (head === 'develop') {
              console.log('PR from develop to master is allowed, skipping.');
              return;
            }

            const message = [
              'Thanks for your contribution! üôè',
              '',
              'However, this pull request targets the `master` branch. All contributions should target the `develop` branch instead.',
              '',
              'Please re-open this PR against `develop`:',
              '',
              '```',
              `gh pr edit ${context.payload.pull_request.number} --base develop`,
              '```',
              '',
              'Or create a new PR targeting `develop` from the GitHub UI.',
            ].join('\n');

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.pull_request.number,
              body: message,
            });

            await github.rest.pulls.update({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.payload.pull_request.number,
              state: 'closed',
            });
